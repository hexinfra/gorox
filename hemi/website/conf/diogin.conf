// shell> ./website -conf conf/diogin.conf

stage {
	.logFile = %logsDir + "/website-worker.log"
	.developerMode = true

	// apps
	app "en_us" {
		.hostnames = ("gorox.org")
		.webRoot   = %baseDir + "/apps/en_us/root"
		.accessLog = [
			"logFile": %logsDir + "/apps/en_us.log",
			"rotate" : "day",
			"format" : "%T",
		]
		.settings = []

		// rules
		rule $path ^= ("/favicon.ico", "/robots.txt", "/static/") {
			static {}
			headReviser {
				.addResponse = ["cache-control" : "max-age=86400"]
			}
			gzipReviser {
				.onContentTypes = ("text/css", "application/javascript")
			}
		}
		rule { // matches all others
			sitex "logic" {
				.rdbms = "mysql://user:pass@host:port/dbname?charset=utf8mb4"
				.sites = [
					"front": [
						"hostnames": ("gorox.org"),
						"viewDir": %baseDir + "/apps/en_us/view",
						"settings": [
							"en_us": "gorox.org",
							"zh_cn": "www.gorox.org",
						],
					],
				]
			}
		}
	}
	app "zh_cn" {
		.hostnames = ("www.gorox.org")
		.webRoot   = %baseDir + "/apps/zh_cn/root"
		.accessLog = [
			"logFile": %logsDir + "/apps/zh_cn.log",
			"rotate" : "day",
			"format" : "%T",
		]
		.settings = []

		// rules
		rule $path ^= ("/favicon.ico", "/robots.txt", "/static/") {
			static {}
			headReviser {
				.addResponse = ["cache-control" : "max-age=86400"]
			}
			gzipReviser {
				.onContentTypes = ("text/css", "application/javascript")
			}
		}
		rule { // matches all others
			sitex "logic" {
				.rdbms = "mysql://user:pass@host:port/dbname?charset=utf8mb4"
				.sites = [
					"front": [
						"hostnames": ("www.gorox.org"),
						"viewDir": %baseDir + "/apps/zh_cn/view",
						"settings": [
							"en_us": "gorox.org",
							"zh_cn": "www.gorox.org",
						],
					],
				]
			}
		}
	}

	// servers
	httpxServer "main" { // tcp
		.forApps = ("en_us", "zh_cn")
		.address = ":80"
	}
}
