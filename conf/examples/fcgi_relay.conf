// shell> ./gorox -config conf/examples/fcgi_relay.conf

stage {
	// backends
	tcpsBackend "fpm1" {
		.dialTimeout = 1s
		.nodes = (
			["address": "127.0.0.1:9000"],
			//["address": "127.0.0.2:9000"],
		)
	}
	tudsBackend "fpm2" {
		.nodes = (
			["address": "/path/to/fpm.sock"],
			//["address": "/path/of/fpm.sock"],
		)
	}

	// apps
	app "php" {
		.hostnames = ("*")
		.webRoot   = %baseDir + "/apps/php/root"

		// rules
		.toBackend = "fpm1" // or fpm2 if unix domain socket is chosen
		rule $path $= ".php" {
			fcgiRelay {}
		}
		rule $path -e {
			static {}
		}
		rule $path == "/favicon.ico" {
			favicon {}
		}
		rule { // matches all others
			fcgiRelay {
				.scriptFilename = .webRoot + "/index.php"
			}
		}
	}

	// servers
	httpxServer "main" {
		.forApps = ("php")
		.address = ":80"
	}
}
